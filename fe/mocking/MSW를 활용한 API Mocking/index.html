<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.21.1"/><style data-href="/styles.811b76fa2f764e4356d7.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css-global w8rgts">@font-face{font-family:'AppleSDGothicNeo';src:local('AppleSDGothicNeo'),url(/static/AppleSDGothicNeoB-4175a777557557f7d2943390d2b123e2.ttf) format('truetype');font-weight:700;}@font-face{font-family:'AppleSDGothicNeo';src:local('AppleSDGothicNeo'),url(/static/AppleSDGothicNeoM-88c00162a2084f97069c5b1b32ba03a9.ttf) format('truetype');font-weight:500;}@font-face{font-family:'AppleSDGothicNeo';src:local('AppleSDGothicNeo'),url(/static/AppleSDGothicNeoR-d159b4d4ce2ef2592daad135a93cc3fa.ttf) format('truetype');font-weight:400;}*{font-family:'AppleSDGothicNeo','Noto Sans','sans-serif';box-sizing:border-box;margin:0;padding:0;}button,input,select,textarea{background-color:transparent;border:0;}button:focus,input:focus,select:focus,textarea:focus{outline:none;box-shadow:none;}html,body,#___gatsby{height:100%;}a,a:hover,button{color:inherit;-webkit-text-decoration:none;text-decoration:none;cursor:pointer;}ul,li{padding:0;list-style:none;}</style><style data-emotion="css 43pv82">.css-43pv82{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding-top:100px;height:100vh;}</style><div class="css-43pv82 e1yuzhxn0"><style data-emotion="css jovut3">.css-jovut3{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;box-sizing:border-box;position:fixed;top:0px;left:0;right:0;padding:1.5rem 2rem 1rem 2rem;background-color:#ffffff;box-shadow:rgba(0, 0, 0, 0.08) 0px 0px 15px;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);opacity:1;-webkit-transition:top 0.5s,opacity 0.5s;transition:top 0.5s,opacity 0.5s;z-index:999;width:100vw;font-size:1.125rem;line-height:32px;font-weight:700;}</style><header class="css-jovut3 etm3hyy4"><div class="css-0 etm3hyy3"><a href="/">yunho.devlog</a></div><style data-emotion="css 2mmmvk">.css-2mmmvk >ul{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:12px;}</style><nav class="css-2mmmvk etm3hyy1"><ul><a class="css-0 etm3hyy0" href="/">Home</a><a class="css-0 etm3hyy0" href="/about">About</a></ul></nav></header><main><style data-emotion="css 16cz9yp">.css-16cz9yp{position:relative;width:100%;height:400px;}@media (max-width: 768px){.css-16cz9yp{height:300px;}}</style><div class="css-16cz9yp e4lxakg1"><style data-emotion="css 1bjn9yo">.css-1bjn9yo{z-index:-1;width:100%;height:400px;object-fit:cover;-webkit-filter:brightness(0.25);filter:brightness(0.25);}@media (max-width: 768px){.css-1bjn9yo{height:300px;}}</style><div data-gatsby-image-wrapper="" style="position:absolute" class="gatsby-image-wrapper gatsby-image-wrapper-constrained css-1bjn9yo e4lxakg0"><div style="max-width:741px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;431&#x27; width=&#x27;741&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABtUlEQVQoz31TCW7cMAzc/z+wSdFdJGjWjg9ZPiXroDQBach1g6I0BEISORyOzNu+J2gd0PcWegwwhgBk5JzB5lyCUg5KWYlZ1+OePcdr7TBNBO+TxN+2LeFZ7fjxUuNZWcxzkoRixiQ8HiNefzZ4eW0w6AjkDK1J4t/eJ3Q9wVo6AIkyQsigCMQI8J7ZWWsRgudcEJW7Y7GVvODZJ6R0kLgVJt55Adn3HcYYVFWFvu/hnJPzeZqQc0KkiBACYgxSOKV0dsP7W9GKYpJLXuWMrey9DwLORZqmgVIK67LC7f4E4+8PIKWrdEfABZiITjbsx3EU4OpZo21bLMtytHwFLCD/WtfWrkWHQYsE31rOSJTxP+OWt22TVnlx66x1eYxC7HyUEKKIz61wAnutNYZhwLzMAsYPZq0RIGM20ZQiFb4HQ67A4OtiMAwj2raT6oVF07ToOgW3h2/9spb8mPn81YQh/7j1p8P93qFpPYz5O4/l+XhuuD96/Lr30GOU5HEk1J87fn/M6BWBJ+4E7DqPZ7Wg7TyW5RitQ5ssE1DXBnW9oqpWTFOUcx63rvdoWgs1RBlRBvwClUqnRIdYspIAAAAASUVORK5CYII=" alt=""/><picture><source type="image/webp" data-srcset="/static/0761103f713e48662ad6bc1c813d5957/b6a9e/overview-msw.webp 185w,/static/0761103f713e48662ad6bc1c813d5957/2b821/overview-msw.webp 371w,/static/0761103f713e48662ad6bc1c813d5957/f7dc6/overview-msw.webp 741w" sizes="(min-width: 741px) 741px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 741px) 741px, 100vw" decoding="async" loading="lazy" data-src="/static/0761103f713e48662ad6bc1c813d5957/a784e/overview-msw.png" data-srcset="/static/0761103f713e48662ad6bc1c813d5957/2ab70/overview-msw.png 185w,/static/0761103f713e48662ad6bc1c813d5957/79e3e/overview-msw.png 371w,/static/0761103f713e48662ad6bc1c813d5957/a784e/overview-msw.png 741w" alt="thumbnail"/></picture><noscript><picture><source type="image/webp" srcSet="/static/0761103f713e48662ad6bc1c813d5957/b6a9e/overview-msw.webp 185w,/static/0761103f713e48662ad6bc1c813d5957/2b821/overview-msw.webp 371w,/static/0761103f713e48662ad6bc1c813d5957/f7dc6/overview-msw.webp 741w" sizes="(min-width: 741px) 741px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 741px) 741px, 100vw" decoding="async" loading="lazy" src="/static/0761103f713e48662ad6bc1c813d5957/a784e/overview-msw.png" srcSet="/static/0761103f713e48662ad6bc1c813d5957/2ab70/overview-msw.png 185w,/static/0761103f713e48662ad6bc1c813d5957/79e3e/overview-msw.png 371w,/static/0761103f713e48662ad6bc1c813d5957/a784e/overview-msw.png 741w" alt="thumbnail"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div><style data-emotion="css m1156n">.css-m1156n{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:768px;height:100%;margin:0 auto;padding:60px 0;color:#ffffff;}@media (max-width: 768px){.css-m1156n{width:100%;padding:40px 20px;}}</style><div class="css-m1156n e40cisa3"><style data-emotion="css gywgo7">.css-gywgo7{display:grid;place-items:center;width:40px;height:40px;border-radius:50%;background:#ffffff;color:#000000;font-size:22px;cursor:pointer;box-shadow:0 0 10px rgba(0, 0, 0, 0.3);}@media (max-width: 768px){.css-gywgo7{width:30px;height:30px;font-size:18px;}}</style><div class="css-gywgo7 e40cisa2"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-left" class="svg-inline--fa fa-arrow-left " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M447.1 256C447.1 273.7 433.7 288 416 288H109.3l105.4 105.4c12.5 12.5 12.5 32.75 0 45.25C208.4 444.9 200.2 448 192 448s-16.38-3.125-22.62-9.375l-160-160c-12.5-12.5-12.5-32.75 0-45.25l160-160c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L109.3 224H416C433.7 224 447.1 238.3 447.1 256z"></path></svg></div><style data-emotion="css gn4qtp">.css-gn4qtp{display:-webkit-box;overflow:hidden;overflow-wrap:break-word;margin-top:auto;text-overflow:ellipsis;white-space:normal;-webkit-line-clamp:2;-webkit-box-orient:vertical;font-size:45px;font-weight:800;}@media (max-width: 768px){.css-gn4qtp{font-size:30px;}}</style><div class="css-gn4qtp e40cisa1">MSW를 활용한 API Mocking</div><style data-emotion="css 3gcnt2">.css-3gcnt2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-top:10px;font-size:18px;font-weight:700;}@media (max-width: 768px){.css-3gcnt2{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;font-size:15px;font-weight:400;}}</style><div class="css-3gcnt2 e40cisa0"><div>WEB / 문제해결 / mocking / 협업</div><div>2023.01.10.</div></div></div></div><style data-emotion="css uo146q">.css-uo146q{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:768px;margin:0 auto;padding:100px 0;word-break:break-all;line-height:1.8;font-size:16px;font-weight:400;}.css-uo146q p{padding:3px 0;}.css-uo146q h1,.css-uo146q h2,.css-uo146q h3{font-weight:800;margin-bottom:30px;}.css-uo146q *+h1,.css-uo146q *+h2,.css-uo146q *+h3{margin-top:80px;}.css-uo146q hr+h1,.css-uo146q hr+h2,.css-uo146q hr+h3{margin-top:0;}.css-uo146q h1{font-size:30px;}.css-uo146q h2{font-size:25px;}.css-uo146q h3{font-size:20px;}.css-uo146q blockquote{margin:30px 0;padding:5px 15px;border-left:2px solid #000000;font-weight:800;}.css-uo146q ol,.css-uo146q ul{margin-left:20px;padding:30px 0;}.css-uo146q hr{border:1px solid #000000;margin:100px 0;}.css-uo146q a{color:#4263eb;-webkit-text-decoration:underline;text-decoration:underline;}.css-uo146q pre[class*='language-']{margin:30px 0;padding:15px;font-size:15px;}.css-uo146q pre[class*='language-']::-webkit-scrollbar-thumb{background:rgba(255, 255, 255, 0.5);border-radius:3px;}.css-uo146q code[class*='language-'],.css-uo146q pre[class*='language-']{tab-size:2;}@media (max-width: 768px){.css-uo146q{width:100%;padding:80px 20px;line-height:1.6;font-size:14px;}.css-uo146q h1{font-size:23px;}.css-uo146q h2{font-size:20px;}.css-uo146q h3{font-size:17px;}.css-uo146q img{width:100%;}.css-uo146q hr{margin:50px 0;}}</style><div class="css-uo146q e1psqq8o0"><h1>1. Mocking API를 사용한 이유</h1>
<p>MSW 및 mocking에 대한 아이디어의 대부분을 <a href="https://tech.kakao.com/2021/09/29/mocking-fe/" target="_blank" rel="nofollow">kakao-tech: Mocking으로 생산성까지 챙기는 FE 개발</a> 해당 글을 통해 알게되었습니다. 참고한 글만큼 전문적이지는 못하지만 제가 고민한 mocking에 대한 내용과 어떤 생각을 가지고 msw를 도입하고 어떤 방법으로 활용했는지 공유하고자 합니다!</p>
<h2>Frontend(FE) 개발자의 입장에서 생긴 개발 병목 현상</h2>
<blockquote>
<p>“000 API 언제쯤 완성되는지 알 수 있을까요???”</p>
</blockquote>
<p>FE개발을 하면서 BE개발에 의존적인 상황이 종종 생겼습니다. BE개발자와 함께 API명세를 상의하고 정의했을 때, mocking 데이터와 mocking API가 만들어지기 전까지 샘플 데이터를 만들어서 개발을 진행했습니다. 샘플 데이터만 있을 때는 api 연결을 확인할 수 없어 UI 위주의 개발 작업을 진행해야 했습니다.</p>
<p>하지만 UI 위주의 개발 또한 디자이너 분의 진행상황에 의존적이었습니다. 화면에 표시될 UI를 디자이너분과 상의한 대로 간단한 배치정도만 구성해도 디자인이 바뀌면 전체적으로 다시 수정해야하는 문제가 발생했습니다.</p>
<p><strong>프로젝트를 진행하면서 기획, FE, BE, 디자인 개발이 동시에 진행되다보니 서비스의 엔드포인트를 담당하는 FE는 의존적인 작업이 많아지고, 그에 따른 개발 진행이 더디게 되었습니다.</strong> 그렇다고 마냥 기다릴 수 없는 상황에서 샘플 데이터와 간단한 배치만 가지고 FE개발을 진행했습니다. API가 완성되거나 디자인이 완성되면 FE코드를 수정해야하는 일이 빈번했고, 같은 로직에 대한 작업을 2,3번씩 하는 경우가 많았습니다. 또한, API가 완성되고 나서야 API에 설계에 대한 오류를 찾을 수 있어 피드백 작업이 늦어졌습니다.</p>
<h2>FE에서 Mocking해서 병목 현상을 해결하자!</h2>
<p>어떻게 하면 다른 팀 작업 현황에 종속적이지 않고, 생산성 있는 개발을 할 수 있을까 고민하던 도중 <a href="https://tech.kakao.com/2021/09/29/mocking-fe/" target="_blank" rel="nofollow">kakao-tech: Mocking으로 생산성까지 챙기는 FE 개발</a> 이라는 글을 발견했습니다. 해당 글에서는 저희가 했던 고민과 비슷한 고민이 담겨 있었고, 그에 대한 해결방안으로 <code class="language-text">Mocking을 통한 사전 개발</code>을 제시했습니다.</p>
<p>BE개발의 의존성을 줄이기 위해서는 BE개발자와 함께 정한 API의 명세를 토대로 FE에서 실제 API를 mocking할 필요가 있었습니다. (지금와서 생각해보면 이러기 위해 미리 API명세를 같이 정한 건가 싶습니다😅 ) 정해진 API명세로 FE개발을 진행한 뒤, BE작업이 완료되는 시점에 API 주소만 바꿔서 테스트하면 효율적인 개발이 가능해질 것이라고 기대했습니다.</p>
<h1>2. 여러 가지 대안 중 MSW를 선택한 이유</h1>
<p>Mock API란 실제 api가 완성되기 전까지 프론트에서 사용할 가짜 api를 의미합니다. mocking api tool에는 json-server, postman-mock-server, msw, express 등등 다양한 방법이 있습니다.</p>
<blockquote>
<p>네트워크 수준에서 요청을 가로채서 모의합니다. 테스트, 개발 및 디버깅을 위해 동일한 모의 정의를 원활하게 재사용합니다. - msw.io</p>
</blockquote>
<p>이전 mocking tool 사용경험과 각각의 장단점을 고려했을 때 프로젝트를 진행하면서 msw를 사용하기로 결정했습니다. <code class="language-text">프로젝트에서 필요한 Mocking 수준은 실제 네트워크 상호작용과 비슷한 수준</code>이어야 하기 때문에 cookie, header setting, delay, query parameter, path variable, custom response가 가능한 msw를 선택했습니다.</p>
<table>
<thead>
<tr>
<th>tool</th>
<th>pros</th>
<th>cons</th>
</tr>
</thead>
<tbody>
<tr>
<td>json-server</td>
<td>js환경에서 쉽게 적용가능하다. <br/> URI 커스텀이 용이하다. <br/> json파일 단위로 관리할 수 있다. <br/> 진입 장벽이 낮다.</td>
<td>진입 장벽이 낮다. <br/> Request에 대한 mocking이 제약이 많다.</td>
</tr>
<tr>
<td>postman-mock-server</td>
<td>API명세를 그대로 활용 가능하다. <br/> GUI로 설치 없이 간단하게 사용가능</td>
<td>한 달 제한: 1000회 <br/> 커스텀한 URI 설정이 어렵다. (path variable을 특정 id로 지정해야한다.)</td>
</tr>
<tr>
<td>express</td>
<td>실제 API와 거의 유사한 완성도으로 실행가능하다. <br/> rest api server 그 자체를 만들 수 있다.</td>
<td>학습 비용이 크다 <br /> 실제 API와 거의 유사한 만큼 구축시간이 오래걸린다.</td>
</tr>
<tr>
<td>msw</td>
<td>실제 API와 거의 유사한 완성도로 실행가능하다. <br/> FE폴더 내에서 쉽게 구축가능하다.</td>
<td>배포환경에서 테스트 API를 사용할 수 없다. <br /> 별도의 DB없이 런타임의 메모리 데이터를 사용한다.</td>
</tr>
</tbody>
</table>
<h1>3. MSW가 동작하는 방식</h1>
<ul>
<li>serivce worker란?</li>
<li>msw 동작 방식</li>
</ul>
<p>프로젝트에서 MSW를 사용한 방법을 설명하기에 앞서 MSW에 대한 설명과 간단한 동작 방법에 대한 설명을 하고자 합니다.</p>
<p>앞서 언급했듯이 MSW는 공식문서에서 “<strong><em>네트워크 수준에서 요청을 가로채서 모의합니다. 테스트, 개발 및 디버깅을 위해 동일한 모의 정의를 원활하게 재사용합니다.</em></strong>” 라고 소개하고 있습니다. MSW는 mock서버를 별도로 구축할 필요 없이 네트워크 수준의 API mocking을 가능하게 합니다. MSW가 이러한 기능을 제공할 수 있는 이유는 <code class="language-text">Service Worker를 통해 HTTP 요청을 가로채기 때문</code>입니다.</p>
<h2>Serivce worker란?</h2>
<blockquote>
<p>서비스 워커는 웹 응용 프로그램, 브라우저, 그리고 (사용 가능한 경우) 네트워크 사이의 프록시 서버 역할을 합니다. - mdn : service worker API</p>
</blockquote>
<blockquote>
<p>Service Worker는 웹 애플리케이션의 메인 스레드와 분리된 별도의 백그라운드 스레드에서 실행시킬 수 있는 기술 중 하나입니다 - <a href="https://tech.kakao.com/2021/09/29/mocking-fe/" target="_blank" rel="nofollow">kakao-tech: Mocking으로 생산성까지 챙기는 FE 개발</a></p>
</blockquote>
<p>위의 내용을 종합해 보면 serive worker란 web serber와 web browser 사이의 <code class="language-text">프록시</code>처럼 동작하는 browser가 <code class="language-text">웹페이지와는 별도로 백그라운드에서 실행하는 스크립트</code>라고 할 수 있습니다.</p>
<p>service worker를 통해 백그라운드 동기화, 높은 비용의 계산을 대신 처리, 푸시 이벤트 생성 등의 다양한 기능을 구현할 수 있습니다. MSW는 serivce woker의 기능 중 <code class="language-text">네트워크의 요청을 가로채는 행위</code>를 활용합니다.</p>
<h2>MSW 동작 원리 및 활용 방법</h2>
<h3>MSW 동작원리</h3>
<p>브라우저에서 MSW는 아래 그림처럼 동작합니다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 741px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/0761103f713e48662ad6bc1c813d5957/660ed/overview-msw.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 58.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABtUlEQVQoz31TCW7cMAzc/z+wSdFdJGjWjg9ZPiXroDQBach1g6I0BEISORyOzNu+J2gd0PcWegwwhgBk5JzB5lyCUg5KWYlZ1+OePcdr7TBNBO+TxN+2LeFZ7fjxUuNZWcxzkoRixiQ8HiNefzZ4eW0w6AjkDK1J4t/eJ3Q9wVo6AIkyQsigCMQI8J7ZWWsRgudcEJW7Y7GVvODZJ6R0kLgVJt55Adn3HcYYVFWFvu/hnJPzeZqQc0KkiBACYgxSOKV0dsP7W9GKYpJLXuWMrey9DwLORZqmgVIK67LC7f4E4+8PIKWrdEfABZiITjbsx3EU4OpZo21bLMtytHwFLCD/WtfWrkWHQYsE31rOSJTxP+OWt22TVnlx66x1eYxC7HyUEKKIz61wAnutNYZhwLzMAsYPZq0RIGM20ZQiFb4HQ67A4OtiMAwj2raT6oVF07ToOgW3h2/9spb8mPn81YQh/7j1p8P93qFpPYz5O4/l+XhuuD96/Lr30GOU5HEk1J87fn/M6BWBJ+4E7DqPZ7Wg7TyW5RitQ5ssE1DXBnW9oqpWTFOUcx63rvdoWgs1RBlRBvwClUqnRIdYspIAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/0761103f713e48662ad6bc1c813d5957/a59e9/overview-msw.webp 192w,
/static/0761103f713e48662ad6bc1c813d5957/0ca9f/overview-msw.webp 384w,
/static/0761103f713e48662ad6bc1c813d5957/d34f7/overview-msw.webp 741w"
              sizes="(max-width: 741px) 100vw, 741px"
              type="image/webp"
            />
          <source
            srcset="/static/0761103f713e48662ad6bc1c813d5957/3b721/overview-msw.png 192w,
/static/0761103f713e48662ad6bc1c813d5957/66595/overview-msw.png 384w,
/static/0761103f713e48662ad6bc1c813d5957/660ed/overview-msw.png 741w"
            sizes="(max-width: 741px) 100vw, 741px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/0761103f713e48662ad6bc1c813d5957/660ed/overview-msw.png"
            alt="overvew-msw"
            title="overvew-msw"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>사진출처: <a href="https://mswjs.io/docs/#request-flow-diagram" target="_blank" rel="nofollow">https://mswjs.io/docs/#request-flow-diagram</a></p>
<ol>
<li>설치 후 request를 보냅니다.</li>
<li>serivice worker에서 request를 복사합니다.</li>
<li>해당 요청과 일치하는 mocks 응답을 생성합니다.</li>
<li>생성한 mock응답을 제공합니다.</li>
<li>제공된 mock 응답을 response로 반환합니다.</li>
</ol>
<h3>MSW 활용 방법</h3>
<p>프로젝트를 진행하면서 다음과 같은 단계를 준수하고자 노력했습니다.</p>
<ol>
<li>요구사항분석</li>
<li>요구사항에 맞는 API 설계</li>
<li>API 명세 작성 (swagger, notion)</li>
<li>MSW mocking API를 활용한 FE개발(UI최소화)</li>
<li>실제 API개발이 완료되면 직접 연결하면서 테스트</li>
<li>피드백 및 수정</li>
</ol>
<h1>4. 간단한 사용 방법 설명</h1>
<h2>핵심 tool 소개</h2>
<p>프로젝트에서 사용한 핵심툴은 다음과 같습니다.</p>
<p><strong>delay() : 의도적인 지연 요청</strong></p>
<p>API 요청이후 의도적인 로딩처리를 위해 의도적으로 요청을 지연(delay)시킬 수 있습니다. 크롬 네트워크 탭의 네트워크 속도 설정과 함께 사용합니다.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// 유저가 읽은 항목 조회</span>
rest<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">ROOT_API_URL</span> <span class="token operator">+</span> <span class="token constant">API</span><span class="token punctuation">.</span><span class="token constant">USER</span><span class="token punctuation">.</span><span class="token constant">READS</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">res</span><span class="token punctuation">(</span>
    ctx<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 응답 상태 결정</span>
    ctx<span class="token punctuation">.</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 응답 시간 결정</span>
    ctx<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token function">getResonseWithData</span><span class="token punctuation">(</span>userList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 응답 결과 생성</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre></div>
<p><strong>cookie(): 쿠키 설정 &#x26; set(): 헤더 설정</strong></p>
<p>다른 mocking API와 비교했을 때 가장 큰 장점 중 하나입니다. 별다른 세팅없이 응답 헤더 및 쿠키를 설정할 수 있습니다.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// src/mocks/authHandler.mock/index.js</span>

rest<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">res</span><span class="token punctuation">(</span>
    ctx<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ctx<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 응답 쿠키 설정</span>
    <span class="token punctuation">{</span>
      <span class="token punctuation">[</span><span class="token constant">TOKEN</span><span class="token punctuation">.</span><span class="token constant">ACCESS</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token string">'something'</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token constant">TOKEN</span><span class="token punctuation">.</span><span class="token constant">REFRESH</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">'something'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 응답 헤더 설정</span>
      <span class="token punctuation">[</span><span class="token constant">TOKEN</span><span class="token punctuation">.</span><span class="token constant">ACCESS</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token string">'something'</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token constant">TOKEN</span><span class="token punctuation">.</span><span class="token constant">REFRESH</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">'something'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ctx<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token function">getResonseWithData</span><span class="token punctuation">(</span>mockLoginData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 응답 결과 생성</span>
	<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre></div>
<p><strong>src/mocks/mockUtils.js</strong></p>
<p>mock api를 위한 유틸함수를 만들어서 반복되는 코드를 줄였습니다.</p>
<ul>
<li>randomResponse(res, ctx, successData): 에러 상황을 위해 램덤으로 상태코드를 반환하는 유틸 함수</li>
<li>getResonseWithData(): response 형태를 제공하는 유틸 함수</li>
</ul>
<h1>5. 프로젝트에 적용한 방법</h1>
<h2>설치 및 실행방법</h2>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 455px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/ec45fa557af02587255483e8d4341ae3/c27a4/install.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 63.541666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAPoAAAD6AG1e1JrAAADJElEQVQozwEZA+b8AMG9nrGumJualq6tpp+el6OinJyblbGwrJmYkX9+eIyLh5STj5+bmJSQjK6tpra1rqSgm7Cspsa4nd7PqQC8t5uZmIRxcm1xb25eXFh1c29qaWWKiYKXlouamo6VkoeSkYiNiYGMh32Ng3mSgnOXhnCml4POwZ/bzakAu7aamZZ+NzYtKSgiKikhLSogLCkhSkg7jYyGo6GioKCgiIWEe2NEYUUsTz8ybVM8a0wrjV0pxqh118imALezl6GcgyssJzAvKSIhHSclISopIy4tJIeDdJSQf5uVg3h2Zl9cXV1NQl5UTlxSSlY+JnBHHLCHUKaWdwBcXFNncHEvMCktKycfHRkjIh4lIx0hIBktLCNOST01MipFQDY4MDUnJCk0NDZQSkpHMR9YOR2FWi1KQzMAMGepO324Nzs1LS8vIB4aJSMdPTsuQD0yaGRRSUU3cGdTf3dff3ZlX1ZSUEdDTzgsQyoch1gmWkkxVk46ADqa7Dmv6TpYYjc7MykqIzs4Li0uKS0vJzQzKDQzKEtHNj87LGFUTUMzP0Y4PVUyJ244JplQN3tYMiYlHAA7rvlHxfhvobs3ODEiIx4bGxksLSYqKSMsKyIfIRkeGhc9KzhIOEtPOi1qSTKFVSygaTOqdTWpej8bGhQANa32N838es3uJCkqHyAdNTk8bGhlbVxGWEk6Wz42UjJCOytHV0Q6V0A0WDsnbkYif1UmkWEqpW0uSjgeACR0nTbR+n6YoqioqLCwsKqqqpGKhqyqqJePhpuZmpuZmoN8er68vbCwsJCQkHZuaJmVlLOtqYxXIo5iLAATJjI2zfFPho9vb29lZWVYWVZHRkKPhneTfmWEdGWTg3SCalSYhnOGdWKGdWJYRjdpWUx6ZlZ/UCCGVyUAERMTJ36TKHaAPj48LC0qFxgVGxoWWVE9raupqKakr62rnZiYVjgdh2Q0hF4uWDkdSzEcUjQaZT0aYjoYAA8PDxUlKSA9QFBPRkVEO0pHPU9MQEtJPH9+eHJuaW5saGhmYkxCLCwkGTguIkQ3MEw+M048LllCMVlBLmB7JgtDSwlsAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/ec45fa557af02587255483e8d4341ae3/a59e9/install.webp 192w,
/static/ec45fa557af02587255483e8d4341ae3/0ca9f/install.webp 384w,
/static/ec45fa557af02587255483e8d4341ae3/e2468/install.webp 455w"
              sizes="(max-width: 455px) 100vw, 455px"
              type="image/webp"
            />
          <source
            srcset="/static/ec45fa557af02587255483e8d4341ae3/3b721/install.png 192w,
/static/ec45fa557af02587255483e8d4341ae3/66595/install.png 384w,
/static/ec45fa557af02587255483e8d4341ae3/c27a4/install.png 455w"
            sizes="(max-width: 455px) 100vw, 455px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/ec45fa557af02587255483e8d4341ae3/c27a4/install.png"
            alt="dev.webp"
            title="dev.webp"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>사진 출처: <a href="https://memegenerator.net/" target="_blank" rel="nofollow">https://memegenerator.net</a></p>
<p>자세한 설치 방법은 <a href="https://mswjs.io/docs/getting-started/install" target="_blank" rel="nofollow">MSW.io - install</a> (공식문서)를 참고해주세요. 공식문서에 설치 방법, 디렉토리 구조, rest API vs Graphql API 선택, node vs web browser 선택 등 단계별로 자세하게 소개하고 있습니다.</p>
<p>공식문서 대로 설치했다면 개발환경에서 MSW를 실행해야합니다. 아래와 같은 설정을 통해 실행했습니다. <code class="language-text">mocking API를 쓰는 개발환경은 npm run msw</code> 명령어로, <code class="language-text">실제 API를 쓰는 개발환경은 npm start</code>로 구분해서 사용했습니다.</p>
<p><code class="language-text">cross-env</code> 라이브러리는 OS에 따른 환경변수 문제를 해결하기 위해 사용했습니다. 저는 주로 MSW를 React와 함께 사용하는데 CRA와 custom webpack 모두 아래와 같이 설정했습니다.</p>
<p><strong>package.json</strong></p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
  <span class="token property">"msw"</span><span class="token operator">:</span> <span class="token string">"cross-env REACT_APP_MOCK_TOOL=msw react-scripts start"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p><strong>src/index.jsx (entry)</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span>
<span class="token keyword">import</span> worker <span class="token keyword">from</span> <span class="token string">'mocks/browser'</span>
<span class="token keyword">import</span> Styles <span class="token keyword">from</span> <span class="token string">'styles'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">REACT_APP_MOCK_TOOL</span> <span class="token operator">===</span> <span class="token string">'msw'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  worker<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">React.StrictMode</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Styles</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Styles</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">React.StrictMode</span></span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span></code></pre></div>
<p>공식문서에 따라 올바르게 설정한 뒤 설정한 프로젝트 환경에 따라 실행하면 개발자 도구에서 다음과 같은 메세지를 확인할 수 있습니다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 652px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/4756da1ba477d6cb14dcc024e18e0405/43b96/result.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 13.020833333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAy0lEQVQI1yWIXUvCUABA9y+CZV4/alcjLHXb/XAtcMTYLi01IVvf0YMS1FvQrz+hPhwO53hx0OVBHuACn/T4iJn0yU4alIGP6jZ3v5I+894hg7agIToI0d7RanUQzW3v2banogmLJKE0FjNSFLHiWhlujCYNFYXWOK0pwhATTZAXlrNRwunQIs81/XFEbxjRH8fIgca7dDX3mz+q1x8SV5Ov1pT1Bvf0Rbb42Hv5iXWP1Otf8rt3lm/fZNULtphx9TxF3U5JVzkqm/MPFCFlmVxevyYAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/4756da1ba477d6cb14dcc024e18e0405/a59e9/result.webp 192w,
/static/4756da1ba477d6cb14dcc024e18e0405/0ca9f/result.webp 384w,
/static/4756da1ba477d6cb14dcc024e18e0405/9a7b5/result.webp 652w"
              sizes="(max-width: 652px) 100vw, 652px"
              type="image/webp"
            />
          <source
            srcset="/static/4756da1ba477d6cb14dcc024e18e0405/3b721/result.png 192w,
/static/4756da1ba477d6cb14dcc024e18e0405/66595/result.png 384w,
/static/4756da1ba477d6cb14dcc024e18e0405/43b96/result.png 652w"
            sizes="(max-width: 652px) 100vw, 652px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/4756da1ba477d6cb14dcc024e18e0405/43b96/result.png"
            alt="result"
            title="result"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<h2>mocks 폴더 구조</h2>
<p>아래 폴더구조는 제가 했던 프로젝트 중 mocks폴더를 구성한 예시입니다.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">.</span> <span class="token comment"># src/mocks</span>
├── handlers.js
├── browser.js
├── mockUtils.js <span class="token comment"># mock api용 유틸함수</span>
├── authHandler.mock
├── commentHandler.mock
├── etcHandler.mock
├── teamHandler.mock
└── userHandler.mock <span class="token comment"># 폴더 하위 파일 구성 예시</span>
    ├── index.js <span class="token comment"># response 구조 모음</span>
    ├── essentialInfo.js <span class="token comment"># mock data</span>
    ├── myPosts.js <span class="token comment"># mock data</span>
    ├── userDetail.js <span class="token comment"># mock data</span>
    └── usersList.js <span class="token comment"># mock data</span></code></pre></div>
<p>도메인에 따른 폴더를 만들고 폴더 하위에 mock 데이터 및 response를 구성했습니다. API 주소의 경우 <code class="language-text">src/constant/api.constant.js</code> 파일에서 상수화한 뒤 api 폴더 및 mock 폴더에서 사용하는 주소를 일치시켰습니다. <code class="language-text">userHandler.mock</code>의 예시 코드는 아래와 같습니다.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> rest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'msw'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  getResonseWithData<span class="token punctuation">,</span>
  getRandomStatusErrorCode<span class="token punctuation">,</span>
  errorResponse<span class="token punctuation">,</span>
  randomResponse<span class="token punctuation">,</span>
  successResponseWithEmptyData<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mocks/mockUtils'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">API</span><span class="token punctuation">,</span> <span class="token constant">ROOT_API_URL</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'constant/api.constant'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> userList <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./usersList'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> myPosts <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./myPosts'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> userDetail <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./userDetail'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mockEssentialInfo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./essentialInfo'</span>

<span class="token keyword">const</span> userHandler <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment">// 유저 필수 정보 조회</span>
  rest<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">ROOT_API_URL</span> <span class="token operator">+</span> <span class="token constant">API</span><span class="token punctuation">.</span><span class="token constant">USER</span><span class="token punctuation">.</span><span class="token constant">ESSENTIAL_INFO</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">res</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token function">getResonseWithData</span><span class="token punctuation">(</span>mockEssentialInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 유저 필수 정보 생성</span>
  rest<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token constant">ROOT_API_URL</span> <span class="token operator">+</span> <span class="token constant">API</span><span class="token punctuation">.</span><span class="token constant">USER</span><span class="token punctuation">.</span><span class="token constant">ESSENTIAL_INFO</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">res</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>successResponseWithEmptyData<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// 유저 목록 조회</span>
  rest<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">ROOT_API_URL</span> <span class="token operator">+</span> <span class="token constant">API</span><span class="token punctuation">.</span><span class="token constant">USER</span><span class="token punctuation">.</span><span class="token constant">INDEX</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> lastPage <span class="token operator">=</span> req<span class="token punctuation">.</span>url<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'lastPage'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> newUserList <span class="token operator">=</span> userList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>user<span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>id <span class="token operator">+</span> lastPage<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// id값 겹치지 않게 설정</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>lastPage<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 무한스크롤 페이지가 3이상이면 에러를 반환하게하기</span>
      <span class="token keyword">return</span> <span class="token function">res</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token function">getResonseWithData</span><span class="token punctuation">(</span>newUserList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// return randomResponse(res, ctx, userList);</span>
    <span class="token keyword">return</span> <span class="token function">res</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token function">getResonseWithData</span><span class="token punctuation">(</span>userList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// ...생략</span>
<span class="token punctuation">]</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> userHandler</code></pre></div>
<h2>storybook과 연동</h2>
<p>스토리북 컴포넌트를 만들다보면 순수한 view를 분리하기 어려울 때가 있었습니다. 혹은 API 요청에 따른 화면 상태(loading, error …) 변화를 체크하기 위해 api와 연동해야할 때가 있었습니다. 이 때, 실제 API가 아닌 만들어둔 MSW mocking api와 mocking data를 활용해 개발과정을 단축할 수 있었습니다.</p>
<p><a href="https://storybook.js.org/addons/msw-storybook-addon" target="_blank" rel="nofollow">msw storybook addon</a> 공식문서에 따라 설치 및 세팅 이후 mock api를 사용하고자 하는 story 컴포넌트에서 다음과 같이 parameter에 Handlers전달했습니다.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> handlers <span class="token keyword">from</span> <span class="token string">'mocks/handlers'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> userList <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'mocks/userHandler.mock/usersList'</span>
<span class="token comment">// 생략</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'pages/UserBoard'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">component</span><span class="token operator">:</span> UserBoard<span class="token punctuation">,</span>
  <span class="token literal-property property">parameters</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">layout</span><span class="token operator">:</span> <span class="token string">'fullscreen'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">msw</span><span class="token operator">:</span> handlers<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Template</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserBoard</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>args<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">EmptyTemplate</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CardsGrid</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>args<span class="token punctuation">}</span></span> <span class="token attr-name">CardComponent</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>UserCard<span class="token punctuation">}</span></span> <span class="token attr-name">clickLink</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">ROUTE</span><span class="token punctuation">.</span><span class="token constant">USER</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span></span> <span class="token attr-name">emptyTrigger</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>emptyTrigger<span class="token punctuation">.</span>user<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
<span class="token punctuation">}</span>

<span class="token comment">// 로딩 -> 성공 / 에러 흐름을 한 번에 보여주는 스토리</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> Default <span class="token operator">=</span> <span class="token function">Template</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
Default<span class="token punctuation">.</span>args <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 요청 성공 이후 UI</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> Empty <span class="token operator">=</span> <span class="token function">EmptyTemplate</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
Empty<span class="token punctuation">.</span>args <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">cards</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">isLoading</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 로딩 상태 스토리</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> LoadingWithSkeleton <span class="token operator">=</span> <span class="token function">EmptyTemplate</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
LoadingWithSkeleton<span class="token punctuation">.</span>args <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">cards</span><span class="token operator">:</span> userList<span class="token punctuation">,</span>
  <span class="token literal-property property">isLoading</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></div>
<h1>6. 사용 후기 및 개선점</h1>
<p>MSW를 도입함으로써 더 이상 백엔드 API가 완성될 때까지 마냥 기다리는 상황은 발생하지 않았습니다. 서비스의 엔드포인트라는 특성 때문에 BE 작업과 디자인 작업 현황과 완전히 독립적일 수는 없지만 개발 과정에서 기다리는 시간을 줄일 수 있었습니다. (동기적인 작업이 아닌 비동기적인 작업이 가능해졌다고 할 수 있을까요? 😀 )</p>
<p>더불어 API 명세를 이전보다 효율성있게 활용할 수 있었습니다. 이전에는 단순히 API에 따른 응답 값만 데이터로 만들고 실제 API완성을 기다렸다면, 이제 mocking api를 통해 실제 네트워크 환경에과 유사한 수준에서 개발을 진행할 수 있었습니다.</p>
<p>앞으로 테스트 코드를 학습하면서 jest 및 react-test-library와 msw를 함께 사용하며 더 나은 유지보수를 위해 개선할 예정입니다 🫠</p>
<h1>참고자료</h1>
<p><a href="https://tech.kakao.com/2021/09/29/mocking-fe/" target="_blank" rel="nofollow">https://tech.kakao.com/2021/09/29/mocking-fe/</a></p>
<p><a href="https://blog.mathpresso.com/msw%EB%A1%9C-api-%EB%AA%A8%ED%82%B9%ED%95%98%EA%B8%B0-2d8a803c3d5c" target="_blank" rel="nofollow">https://blog.mathpresso.com/msw로-api-모킹하기-2d8a803c3d5c</a></p>
<p><a href="https://mswjs.io/" target="_blank" rel="nofollow">https://mswjs.io</a></p>
<p><a href="https://developer.mozilla.org/ko/docs/Web/API/Service_Worker_API" target="_blank" rel="nofollow">https://developer.mozilla.org/ko/docs/Web/API/Service_Worker_API</a></p>
<p><a href="https://b.limminho.com/archives/1384" target="_blank" rel="nofollow">https://b.limminho.com/archives/1384</a></p>
<style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line > * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: ' ';
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {
    content: ' ';
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
</style></div><div></div></main><style data-emotion="css 1tiqe12">.css-1tiqe12{margin-top:32px;padding:40px 0;text-align:center;font-size:11pt;}</style><footer class="css-1tiqe12 effjp210">© 2022 Developer YunHo(Dori), Powered By Gatsby.</footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/fe/mocking/MSW를 활용한 API Mocking";window.___webpackCompilationHash="6b9ef1ff770bf7562b94";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-c9fa82aa5b1f9c65f078.js"],"app":["/app-ee800f17e1d461bb6502.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-79d3c5091224294f6f28.js"],"component---src-pages-about-tsx":["/component---src-pages-about-tsx-4b15d9561a8e14a15637.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-4ee5b5902968014bb8e8.js"],"component---src-templates-post-template-tsx":["/component---src-templates-post-template-tsx-c28d493da4099f4a372b.js"]};/*]]>*/</script><script src="/polyfill-c9fa82aa5b1f9c65f078.js" nomodule=""></script><script src="/app-ee800f17e1d461bb6502.js" async=""></script><script src="/framework-c57a9454c0e3bef16c3b.js" async=""></script><script src="/webpack-runtime-4819bfa581389647fb7e.js" async=""></script></body></html>